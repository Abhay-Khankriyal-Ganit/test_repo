      - name: Create or Update Glue job
        run: |
          JOB_NAME="${{ matrix.job }}"
          SCRIPT_S3_PATH="s3://${S3_BUCKET}/${SCRIPT_PREFIX}${{ github.run_id }}/${JOB_NAME}.py"
 
          echo "Processing Glue job: $JOB_NAME"
          echo "Script path: $SCRIPT_S3_PATH"
 
          # Build job definition
          cat > job-config.json <<EOF
{
  "Role": "${GLUE_ROLE_ARN}",
  "Command": {
    "Name": "glueetl",
    "ScriptLocation": "${SCRIPT_S3_PATH}",
    "PythonVersion": "3"
  },
  "ExecutionProperty": {
    "MaxConcurrentRuns": 1
  },
  "MaxRetries": 0,
  "GlueVersion": "3.0",
  "NumberOfWorkers": 2,
  "WorkerType": "G.1X"
}
EOF
 
          # Check if job exists
          if aws glue get-job --job-name "$JOB_NAME" >/dev/null 2>&1; then
            echo "Updating Glue job: $JOB_NAME"
            aws glue update-job \
              --job-name "$JOB_NAME" \
              --job-update file://job-config.json \
              --region "$AWS_REGION"
          else
            echo "Creating Glue job: $JOB_NAME"
            aws glue create-job \
              --name "$JOB_NAME" \
              --role "$GLUE_ROLE_ARN" \
              --command "Name=glueetl,ScriptLocation=${SCRIPT_S3_PATH},PythonVersion=3" \
              --execution-property "MaxConcurrentRuns=1" \
              --max-retries 0 \
              --glue-version "3.0" \
              --number-of-workers 2 \
              --worker-type G.1X \
              --region "$AWS_REGION"
          fi
