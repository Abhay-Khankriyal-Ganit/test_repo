#!/bin/bash
# Usage: bash create_glue_job.sh <JOB_NAME> <GLUE_ROLE_ARN> <SCRIPT_S3_PATH>
 
JOB_NAME=$1
GLUE_ROLE_ARN=$2
SCRIPT_S3_PATH=$3
 
if [ -z "$JOB_NAME" ] || [ -z "$GLUE_ROLE_ARN" ] || [ -z "$SCRIPT_S3_PATH" ]; then
    echo "Usage: $0 <JOB_NAME> <GLUE_ROLE_ARN> <SCRIPT_S3_PATH>"
    exit 1
fi
 
echo "Creating job-config.json for $JOB_NAME"
 
# Generate JSON file
cat <<EOL > job-config.json
{
  "Name": "$JOB_NAME",
  "Role": "$GLUE_ROLE_ARN",
  "Command": {
    "Name": "glueetl",
    "ScriptLocation": "$SCRIPT_S3_PATH",
    "PythonVersion": "3"
  },
  "MaxRetries": 0,
  "GlueVersion": "3.0",
  "NumberOfWorkers": 2,
  "WorkerType": "Standard"
}
EOL
 
# Create or update Glue job
if aws glue get-job --job-name "$JOB_NAME" >/dev/null 2>&1; then
    echo "Updating Glue job: $JOB_NAME"
    aws glue update-job --job-name "$JOB_NAME" --job-update file://job-config.json
else
    echo "Creating Glue job: $JOB_NAME"
    aws glue create-job --cli-input-json file://job-config.json
fi
